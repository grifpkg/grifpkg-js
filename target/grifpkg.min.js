var __awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,u)}c((r=r.apply(t,e||[])).next())}))};class APIException extends Error{constructor(t){super(t),Object.setPrototypeOf(this,APIException.prototype)}}class Grif{constructor(t=null){Grif.session=t,null==t&&(Grif.session=this.fromBrowser())}isAuthenticated(){return null!=Grif.session}getSession(){return new Session(null,Grif.session,null,null,null,null,null)}static login(t=!0){return __awaiter(this,void 0,void 0,(function*(){if(null==window)throw new APIException("In order to create a login popup, you must be executing grifpkg from a Document Object Model");{let e=600,i=400;const r=window.top.outerHeight/2+window.top.screenY-e/2,n=window.top.outerWidth/2+window.top.screenX-i/2;let s=window.open("https://api.grifpkg.com/rest/1/login/","Login",`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${i}, height=${e}, top=${r}, left=${n}`),o=!0,u=setInterval((()=>{if(s.closed&&o)throw o=!1,new APIException("The popup was closed before any session was retrieved")}),50),c=yield new Promise((function(t,e){window.addEventListener("message",(e=>{o&&"https://api.grifpkg.com"==e.origin&&(o=!1,t(e))}),!1)}));switch(c.data.type){case"login":if("error"in c.data.data)throw new APIException(c.data.data.error);return t&&(localStorage.setItem(btoa("grifpkg"),btoa(String(c.data.data.session.hash))),Grif.session=String(c.data.data.session.hash)),o=!1,clearInterval(u),s.closed||s.close(),Session.fromObject(c.data.data.session)}}}))}logout(t=!0){return __awaiter(this,void 0,void 0,(function*(){let e=yield Grif.request("/session/close/");return t&&(Grif.session=null,localStorage.removeItem(btoa("grifpkg"))),Session.fromObject(e)}))}static request(t,e=null,i=null){return __awaiter(this,void 0,void 0,(function*(){let r={method:null==e?"GET":"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:null!=i?`Bearer ${i}`:null!=Grif.session?`Bearer ${Grif.session}`:null},redirect:"follow",referrerPolicy:"no-referrer"};null!=e&&(r.body=JSON.stringify(e));const n=yield fetch(`https://api.grifpkg.com/rest/1${t}`,r);let s=null;try{s=JSON.parse(yield n.text())}catch(t){}if(n.status>=300||n.status<200)throw new APIException(null!=s&&"object"==typeof s&&"error"in s?s.error:`server replied with ${String(n.status)}`);return s}))}fromBrowser(){let t=localStorage.getItem(btoa("grifpkg"));return null==t?null:atob(t)}}try{module.exports=Grif}catch(t){}class Account{constructor(t,e,i){this.id=t,this.username=e,this.githubId=i}getId(){return this.id}getUsername(){return this.username}getGithubId(){return this.githubId}static fromObject(t){return new Account(t.id,t.username,t.githubId)}update(){return __awaiter(this,void 0,void 0,(function*(){let t=yield Grif.request("/session/account/");return this.id=t.id,this.username=t.username,this.githubId=t.githubId,this}))}getSessions(){return __awaiter(this,void 0,void 0,(function*(){let t=new Array;return(yield Grif.request("/session/list/")).forEach((e=>{t.push(Session.fromObject(e))})),t}))}getNotifications(){return __awaiter(this,void 0,void 0,(function*(){let t=new Array;return(yield Grif.request("/notifications/get/")).forEach((e=>{t.push(Alert.fromObject(e))})),t}))}commercialSubscribe(t){return __awaiter(this,void 0,void 0,(function*(){yield Grif.request("/notifications/commercial/",{subscribe:t})}))}isCommercialSubscribed(){return __awaiter(this,void 0,void 0,(function*(){return yield Grif.request("/notifications/config/")}))}setBillingAddress(t,e,i,r,n,s,o,u){return __awaiter(this,void 0,void 0,(function*(){yield Grif.request("/billing/address/set/",{line1:t,line2:e,postCode:i,city:r,state:n,country:s,phone:o,name:u})}))}getBillingAddress(){return __awaiter(this,void 0,void 0,(function*(){return yield Grif.request("/billing/address/get/")}))}listSources(){return __awaiter(this,void 0,void 0,(function*(){let t=yield Grif.request("/billing/source/list/");return SourceList.fromObject(t)}))}setDefaultSource(t){return __awaiter(this,void 0,void 0,(function*(){yield Grif.request("/billing/source/default/",{source:t})}))}attachSource(t){return __awaiter(this,void 0,void 0,(function*(){yield Grif.request("/billing/source/attach/",{source:t})}))}detachSource(t){return __awaiter(this,void 0,void 0,(function*(){yield Grif.request("/billing/source/detach/",{source:t})}))}}class Session{constructor(t,e,i,r,n,s,o){this.id=t,this.hash=e,this.userAgent=i,this.creation=r,this.expiry=n,this.city=s,this.country=o}static fromObject(t){return new Session(t.id,t.hash,t.userAgent,new Date(1e3*t.creation),null==t.expiry?null:new Date(1e3*t.expiry),t.city,t.country)}getId(){return this.id}getUserAgent(){return this.userAgent}getCreation(){return this.creation}getExpiry(){return this.expiry}getCity(){return this.city}getCountry(){return this.country}getAccount(){return new Account(null,null,null)}close(){return __awaiter(this,void 0,void 0,(function*(){let t=yield Grif.request("/session/close/",null,this.hash);return Session.fromObject(t)}))}update(){return __awaiter(this,void 0,void 0,(function*(){let t=yield Grif.request("/session/get/");return this.id=t.id,this.hash=t.hash,this.userAgent=t.userAgent,this.creation=new Date(1e3*t.creation),this.expiry=null==t.expiry?null:new Date(1e3*t.expiry),this.city=t.city,this.country=t.country,this}))}}class SourceList{constructor(t,e){this.default=t,this.sources=e}static fromObject(t){let e=new Array;return t.sources.forEach((t=>{e.push(t)})),new SourceList(t.default,e)}getDefault(){return this.default}getAll(){return this.sources}}class Alert{constructor(t,e,i,r,n,s,o){this.id=t,this.creation=e,this.seen=i,this.action=r,this.subject=n,this.text=s,this.commercial=o}getId(){return this.id}getCreation(){return this.creation}getSeen(){return this.seen}getAction(){return this.action}getSubject(){return this.subject}getText(){return this.text}isCommercial(){return this.commercial}static fromObject(t){return new Alert(t.id,new Date(1e3*t.creation),null==t.seen?null:new Date(1e3*t.seen),t.action,t.subject,t.text,t.commercial)}}